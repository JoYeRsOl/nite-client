(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[24],{806:e=>{e.exports={voiceRoom:"voice-room_voiceRoom__Z2Hov",videoFrame:"voice-room_videoFrame__gBw9g",videoFeed:"voice-room_videoFeed__YzH1d",video:"voice-room_video__cz1ZP",voiceRoomActionBar:"voice-room_voiceRoomActionBar__W1uH7"}},1226:()=>{},1909:e=>{e.exports={server:"server-page_server__j1jRo",container:"server-page_container__3MN4L"}},2154:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>u});var n=t(5155),c=t(2115),r=t(1909),s=t.n(r),i=t(6278),a=t(9335);function u(){let{localStream:e}=(0,a.WO)();return(0,n.jsx)("div",{className:s().container,children:(0,n.jsx)("div",{className:s().server,children:(0,n.jsx)(c.Suspense,{children:(0,n.jsx)(i.mr,{localStream:e})})})})}},2531:(e,o,t)=>{"use strict";let n;t.d(o,{qU:()=>a,sM:()=>s,cH:()=>r,sZ:()=>n,t5:()=>u,dS:()=>d,LV:()=>i});var c=t(4298);function r(){if(!n)return void console.log("Socket not initialized, cannot connect");n.connected||n.connect()}function s(){n&&n.disconnect()}function i(e){(n=(0,c.io)(e,{autoConnect:!1,extraHeaders:{"ngrok-skip-browser-warning":"123"}})).on("connect_error",e=>{console.log("connect_error due to ".concat(e.message)),console.log("connect_error due to ".concat(e.name)),console.log("connect_error due to ".concat(e.stack))})}var a=function(e){return e.Call="Call",e.Camera="Camera",e.Microphone="Microphone",e.Sound="Sound",e}({});let u={Call:"./icon/voiceroom-call-off.svg",Camera:"./icon/voiceroom-camera-off.svg",Microphone:"./icon/voiceroom-microphone-off.svg",Sound:"./icon/voiceroom-sound-off.svg"},d={Call:"./icon/voiceroom-call-on.svg",Camera:"./icon/voiceroom-camera-on.svg",Microphone:"./icon/voiceroom-microphone-on.svg",Sound:"./icon/voiceroom-sound-on.svg"}},2696:(e,o,t)=>{Promise.resolve().then(t.bind(t,2154))},3262:(e,o,t)=>{"use strict";t.d(o,{d:()=>a});var n=t(5155),c=t(2531),r=t(8457),s=t(2115),i=t(6278);function a(){let e=(0,s.useContext)(i.TP);return(0,n.jsx)(r.f,{icon:c.qU.Microphone,onClick:o=>{e.setState({...e.context,microphoneMuted:o})}})}},3409:(e,o,t)=>{"use strict";t.d(o,{$:()=>i});var n=t(5155),c=t(4493),r=t(806),s=t.n(r);function i(e){let{streams:o}=e;return(0,n.jsx)("div",{className:s().videoFrame,children:o.map(e=>(0,n.jsx)(c.K,{mediaStream:e.mediaStream,isMuted:e.isMuted}))})}},4493:(e,o,t)=>{"use strict";t.d(o,{K:()=>i});var n=t(5155),c=t(2115),r=t(806),s=t.n(r);function i(e){let{mediaStream:o,isMuted:t=!1}=e,r=(0,c.useRef)(null);return(0,c.useEffect)(()=>{r.current&&o&&(r.current.srcObject=o)},[o]),(0,n.jsx)("div",{className:s().videoFeed,children:(0,n.jsx)("video",{className:s().video,ref:r,autoPlay:!0,playsInline:!0,muted:t})})}},6247:e=>{e.exports={toggleButton:"toggle-button_toggleButton__xEj1Z"}},6278:(e,o,t)=>{"use strict";t.d(o,{TP:()=>_,mr:()=>h});var n=t(5155),c=t(2115),r=t(806),s=t.n(r),i=t(2531),a=t(9335),u=t(5695),d=t(7718),l=t(6417),f=t(3262),v=t(9743),m=t(3409);let g={microphoneMuted:!1,soundMuted:!1,video:!0},_=(0,c.createContext)({context:g,setState:()=>{}});function h(e){let{localStream:o}=e,[t,r]=(0,c.useState)(g),d=(0,u.useSearchParams)(),l=d.get("roomName")||"",f=d.get("serverUrl")||"";(0,c.useEffect)(()=>((0,i.LV)(f),()=>{(0,i.sM)()}));let v=(0,a.yK)({localStream:o,roomName:l});(0,a.ow)({peerConnection:v.peerConnection,roomName:l}),(0,c.useEffect)(()=>{o&&(o.getAudioTracks()[0].enabled=t.microphoneMuted)},[t.microphoneMuted]),(0,c.useEffect)(()=>{v.guestStream&&(v.guestStream.getAudioTracks()[0].enabled=t.microphoneMuted)},[t.soundMuted]),(0,c.useEffect)(()=>{o&&(o.getVideoTracks()[0].enabled=t.video)},[t.video]);let h=[];return o&&h.push({mediaStream:o,isMuted:!0}),v.guestStream&&h.push({mediaStream:v.guestStream,isMuted:!1}),(0,n.jsx)("div",{className:s().voiceRoom,children:(0,n.jsxs)(_.Provider,{value:{context:t,setState:r},children:[(0,n.jsx)(m.$,{streams:h}),(0,n.jsx)(C,{})]})})}function C(){return(0,n.jsxs)("div",{className:s().voiceRoomActionBar,children:[(0,n.jsx)(f.d,{}),(0,n.jsx)(v.u,{}),(0,n.jsx)(l.G,{}),(0,n.jsx)(d.Q,{})]})}},6417:(e,o,t)=>{"use strict";t.d(o,{G:()=>a});var n=t(5155),c=t(2531),r=t(8457),s=t(2115),i=t(6278);function a(){let e=(0,s.useContext)(i.TP);return(0,n.jsx)(r.f,{icon:c.qU.Camera,onClick:o=>{e.setState({...e.context,video:o})}})}},7718:(e,o,t)=>{"use strict";t.d(o,{Q:()=>i});var n=t(5155),c=t(2531),r=t(8457),s=t(3784);function i(){let e=(0,s.useRouter)();return(0,n.jsx)(r.f,{icon:c.qU.Call,onClick:()=>{e.push("/")}})}},8457:(e,o,t)=>{"use strict";t.d(o,{f:()=>u});var n=t(5155),c=t(6247),r=t.n(c),s=t(6766),i=t(2115),a=t(2531);function u(e){let{icon:o,onClick:t}=e,[c,u]=(0,i.useState)(a.dS[o]),[d,l]=(0,i.useState)(!0);return console.log("State: ".concat(d," icon: ").concat(c)),(0,i.useEffect)(()=>{u(d?a.t5[null!=o?o:a.qU.Sound]:a.dS[null!=o?o:a.qU.Sound])},[d]),(0,n.jsx)("div",{className:r().toggleButton,onClick:()=>{l(!d),t&&t(!d)},children:(0,n.jsx)(s.default,{src:c,alt:"pohui mne",width:24,height:24})})}},9335:(e,o,t)=>{"use strict";t.d(o,{ow:()=>r,WO:()=>s,yK:()=>i});var n=t(2115),c=t(2531);function r(e){let{peerConnection:o,roomName:t}=e;console.log("useChatConnection:".concat(t,":").concat(o));let{sendOffer:r}=function(e){let{peerConnection:o,roomName:t}=e;return{sendOffer:(0,n.useCallback)(async()=>{if(!o||!t)return;console.log("useOfferSending");let e=await o.createOffer();await o.setLocalDescription(e),c.sZ.emit("send_connection_offer",{roomName:t,offer:e})},[t,o])}}({peerConnection:o,roomName:t}),{handleConnectionOffer:s}=function(e){let{peerConnection:o,roomName:t}=e;return{handleConnectionOffer:(0,n.useCallback)(async e=>{let{offer:n}=e;if(!o||!t)return;console.log("useSendingAnswer"),await o.setRemoteDescription(n);let r=await o.createAnswer();await o.setLocalDescription(r),c.sZ.emit("answer",{answer:r,roomName:t})},[t,o])}}({peerConnection:o,roomName:t}),{handleOfferAnswer:i}={handleOfferAnswer:(0,n.useCallback)(e=>{let{answer:t}=e;o&&(console.log("useAnswerProcessing"),o.setRemoteDescription(t))},[o])},a=(0,n.useCallback)(()=>{c.sZ.emit("join_room",t)},[t]),u=(0,n.useCallback)(e=>{let{candidate:t}=e;o&&o.addIceCandidate(t)},[o]);(0,n.useEffect)(()=>{if(c.sZ&&o)return(0,c.cH)(),c.sZ.on("answer",i),c.sZ.on("send_connection_offer",s),c.sZ.on("another_person_ready",r),c.sZ.on("connect",a),c.sZ.on("send_candidate",u),()=>{c.sZ.off("answer",i),c.sZ.off("send_connection_offer",s),c.sZ.off("another_person_ready",r),c.sZ.off("connect",a),c.sZ.off("send_candidate",u)}},[t,a,s,i,r,u])}function s(){let[e,o]=(0,n.useState)();return(0,n.useEffect)(()=>{navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(e=>{o(e)})},[]),{localStream:e}}function i(e){let{roomName:o,localStream:t}=e,[r,s]=(0,n.useState)();return{peerConnection:(0,n.useMemo)(()=>{if(t&&o){let e=new RTCPeerConnection({iceServers:[{urls:"stun:stun2.1.google.com:19302"}]});return e.addEventListener("icecandidate",e=>{let{candidate:t}=e;t&&c.sZ.emit("send_candidate",{candidate:t,roomName:o})}),e.addEventListener("track",e=>{let{streams:o}=e;console.log("Received remote track:",o),o&&o[0]&&s(o[0])}),e.addEventListener("connectionstatechange",()=>{console.log("Connection state:",e.connectionState)}),e.addEventListener("iceconnectionstatechange",()=>{console.log("ICE connection state:",e.iceConnectionState)}),t.getTracks().forEach(o=>{e.addTrack(o,t)}),e}},[t]),guestStream:r}}},9743:(e,o,t)=>{"use strict";t.d(o,{u:()=>a});var n=t(5155),c=t(2531),r=t(8457),s=t(6278),i=t(2115);function a(){let e=(0,i.useContext)(s.TP);return(0,n.jsx)(r.f,{icon:c.qU.Sound,onClick:o=>{e.setState({...e.context,soundMuted:o})}})}}},e=>{var o=o=>e(e.s=o);e.O(0,[295,194,441,684,358],()=>o(2696)),_N_E=e.O()}]);